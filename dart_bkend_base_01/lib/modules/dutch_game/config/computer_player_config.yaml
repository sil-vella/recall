# Computer Player Configuration for Dutch Game
# This file defines declarative behavior for computer players
# Used by both Dart (frontend) and Python (backend) computer player logic, however different directories.
#  For the flutter side, this file is in the assets directory, and for the python side, this file is in the config directory.

# Global computer player settings
computer_settings:
  default_difficulty: "medium"
  decision_delay_seconds: 1.0
  error_rate: 0.05
  # Miss chance to play (probability of not playing when action is available)
  miss_chance_to_play:
    easy: 0.05    # 5% miss chance
    medium: 0.03  # 3% miss chance
    hard: 0.01    # 1% miss chance
    expert: 0.0   # 0% miss chance

# Difficulty levels and their corresponding behaviors
difficulties:
  easy:
    name: "Easy"
    description: "Beginner-friendly AI with simple decision making"
    decision_delay_seconds: 3.0
    error_rate: 0.1  # 10% chance of making suboptimal decisions
    
    # Card selection strategy
    card_selection:
      strategy: "random"  # random, points_low, points_high, special_power
      special_power_preference: 0.3  # 30% preference for special cards
      
    # Dutch calling strategy
    dutch_strategy:
      min_cards_threshold: 1
      max_points_threshold: 3
      call_probability: 0.8  # 80% chance to call when conditions met
      
    # Special card usage
    special_cards:
      jack_swap:
        use_probability: 0.6  # 60% chance to use Jack swap
        target_strategy: "random"  # random, lowest_points, highest_points
      queen_peek:
        use_probability: 0.7  # 70% chance to use Queen peek
        target_strategy: "random"  # random, most_cards, least_cards

  medium:
    name: "Medium"
    description: "Balanced AI with moderate decision making"
    decision_delay_seconds: 2.5
    error_rate: 0.05  # 5% chance of making suboptimal decisions
    
    card_selection:
      strategy: "points_low"  # Prefer lower point cards
      special_power_preference: 0.5  # 50% preference for special cards
      
    dutch_strategy:
      min_cards_threshold: 2
      max_points_threshold: 5
      call_probability: 0.9
      
    special_cards:
      jack_swap:
        use_probability: 0.8
        target_strategy: "lowest_points"
      queen_peek:
        use_probability: 0.8
        target_strategy: "most_cards"

  hard:
    name: "Hard"
    description: "Advanced AI with strategic decision making"
    decision_delay_seconds: 2.0
    error_rate: 0.02  # 2% chance of making suboptimal decisions
    
    card_selection:
      strategy: "strategic"  # Complex strategic evaluation
      special_power_preference: 0.7  # 70% preference for special cards
      
    dutch_strategy:
      min_cards_threshold: 3
      max_points_threshold: 7
      call_probability: 0.95
      
    special_cards:
      jack_swap:
        use_probability: 0.9
        target_strategy: "strategic"  # Complex target selection
      queen_peek:
        use_probability: 0.9
        target_strategy: "strategic"

  expert:
    name: "Expert"
    description: "Master-level AI with optimal decision making"
    decision_delay_seconds: 1.5
    error_rate: 0.0  # No errors
    
    card_selection:
      strategy: "optimal"  # Perfect strategic evaluation
      special_power_preference: 0.8  # 80% preference for special cards
      
    dutch_strategy:
      min_cards_threshold: 4
      max_points_threshold: 10
      call_probability: 1.0  # Always call when conditions met
      
    special_cards:
      jack_swap:
        use_probability: 1.0
        target_strategy: "optimal"
      queen_peek:
        use_probability: 1.0
        target_strategy: "optimal"

# Event-specific behaviors
events:
  draw_card:
    # Decision logic for drawing cards
    draw_from_discard_probability:
      easy: 0.0    # Always draw from deck for easier testing
      medium: 0.0  # Always draw from deck for easier testing
      hard: 0.0    # Always draw from deck for easier testing
      expert: 0.0  # Always draw from deck for easier testing
      
  play_card:
    # Decision logic for playing cards
    card_evaluation_weights:
      points: 0.4      # Weight for card points
      special_power: 0.3  # Weight for special powers
      game_phase: 0.2   # Weight for current game phase
      opponent_analysis: 0.1  # Weight for opponent analysis
    
    # Strategy selection probabilities
    optimal_play_probability:
      easy: 0.6      # 60% chance to play optimally
      medium: 0.8    # 80% chance to play optimally
      hard: 0.95     # 95% chance to play optimally
      expert: 1.0    # 100% chance to play optimally (always optimal)
    
    # Strategy definitions
    strategies:
      best_option: "random_unknown_card"  # Play random card not in known_cards
      fallback_option: "highest_known_points"  # Play highest points from known_cards (exclude Jacks)
    
    # NEW: YAML-driven strategy rules
    strategy_rules:
      # Rule 1: Play random unknown card (best option)
      - name: "play_random_unknown_card"
        priority: 1
        description: "Play a random card that is not in known_cards"
        condition:
          type: "and"
          conditions:
            - field: "unknown_cards"
              operator: "not_empty"
        action:
          type: "select_random"
          source: "unknown_cards"
      
      # Rule 2: Play highest points from known cards (fallback)
      - name: "play_highest_known_points"
        priority: 2
        description: "Play card with highest points from known_cards, excluding Jacks"
        condition:
          type: "and"
          conditions:
            - field: "known_cards"
              operator: "not_empty"
        action:
          type: "select_highest_points"
          source: "known_cards"
          filters:
            - type: "exclude_rank"
              value: "jack"
      
      # Rule 3: Random fallback (worst option)
      - name: "play_random_playable"
        priority: 3
        description: "Play any random playable card"
        condition:
          type: "always"
        action:
          type: "select_random"
          source: "playable_cards"
      
  same_rank_play:
    # Decision logic for same rank plays
    play_probability:
      easy: 0.9     # 90% chance to attempt (10% miss)
      medium: 0.95  # 95% chance to attempt (5% miss)
      hard: 0.98    # 98% chance to attempt (2% miss)
      expert: 1.0   # 100% chance - never misses
    
    # Probability of playing WRONG rank (accuracy)
    wrong_rank_probability:
      easy: 0.25    # 25% chance to play wrong card
      medium: 0.10  # 10% chance to play wrong card
      hard: 0.02    # 2% chance to play wrong card
      expert: 0.0   # 0% chance - always accurate
    
    # NEW: Strategy rules for intelligent card selection
    strategy_rules:
      # Rule 1: Prefer unknown cards of same rank (best strategy)
      - name: "play_unknown_same_rank"
        priority: 1
        description: "Prefer unknown cards of same rank (best strategy)"
        condition:
          type: "and"
          conditions:
            - field: "unknown_same_rank_cards"
              operator: "not_empty"
        action:
          type: "select_random"
          source: "unknown_same_rank_cards"
      
      # Rule 2: Play highest points card of same rank from known cards
      - name: "play_highest_points_same_rank"
        priority: 2
        description: "Play highest points card of same rank from known cards"
        condition:
          type: "and"
          conditions:
            - field: "known_same_rank_cards"
              operator: "not_empty"
        action:
          type: "select_highest_points"
          source: "known_same_rank_cards"
      
      # Rule 3: Random fallback
      - name: "random_fallback_same_rank"
        priority: 3
        description: "Play any available same rank card"
        condition:
          type: "always"
        action:
          type: "select_random"
          source: "available_same_rank_cards"
      
  jack_swap:
    # Decision logic for Jack swap
    swap_targets:
      strategy: "points_analysis"  # Analyze opponent points
      preferred_targets: ["lowest_points", "most_cards"]
    
    # Strategy selection probabilities (similar to play_card)
    optimal_swap_probability:
      easy: 0.6      # 60% chance to swap optimally
      medium: 0.8    # 80% chance to swap optimally
      hard: 0.95     # 95% chance to swap optimally
      expert: 1.0    # 100% chance to swap optimally (always optimal)
    
    # NEW: YAML-driven strategy rules (ordered from expert down to easy)
    strategy_rules:
      # Rule 1: When isClearAndCollect, if any player (excl. acting) has 3 cards in collection: swap last in list
      # If 2+ players have 3 in collection, swap last card from each; else swap last from one with non-collection from another
      - name: "collection_three_swap"
        priority: 1
        description: "When clear-and-collect, swap involving players with 3+ in collection (last in list)"
        condition:
          type: "and"
          conditions:
            - field: "isClearAndCollect"
              operator: "equals"
              value: true
            - field: "other_players_with_three_in_collection"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "collection_three_swap"
        execution_probability:
          expert: 1.0    # 100% chance to execute if condition met
          hard: 0.95     # 95% chance to execute if condition met
          medium: 0.7    # 70% chance to execute if condition met
          easy: 0.5      # 50% chance to execute if condition met
      
      # Rule 2: If any player (excl. acting) has only 1 card in hand, swap that card with any other player's card
      - name: "one_card_player_priority"
        priority: 2
        description: "Swap involving a player with only 1 card (priority); other card from any other player (excl. acting)"
        condition:
          type: "and"
          conditions:
            - field: "other_players_with_one_card"
              operator: "not_empty"
            - field: "all_players"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "one_card_player_priority"
        execution_probability:
          expert: 1.0    # 100% chance to execute if condition met
          hard: 0.95     # 95% chance to execute if condition met
          medium: 0.7    # 70% chance to execute if condition met
          easy: 0.5      # 50% chance to execute if condition met
      
      # Rule 3 (Expert/Hard): Swap if player knows opponent's lowest point card and has higher point card in own known cards
      - name: "swap_lowest_opponent_for_higher_own"
        priority: 3
        description: "Swap if player knows opponent's lowest point card and has higher point card in own known cards"
        condition:
          type: "and"
          conditions:
            - field: "acting_player.known_cards"
              operator: "not_empty"
            - field: "all_players"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "lowest_opponent_higher_own"
        execution_probability:
          expert: 1.0    # 100% chance to execute if condition met
          hard: 0.95     # 95% chance to execute if condition met
          medium: 0.7    # 70% chance to execute if condition met
          easy: 0.5      # 50% chance to execute if condition met
      
      # Rule 4: Random swap of 2 cards from other players only (excl. collection, not our hand)
      - name: "random_swap_except_own"
        priority: 4
        description: "Randomly swap 2 cards (excl. collection) from any players except our hand"
        condition:
          type: "and"
          conditions:
            # At least 2 other players (or 1 with 2+ playable cards)
            - field: "all_players"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "random_except_own"
        execution_probability:
          expert: 0.0    # 0% (expert uses rule 1 or 2)
          hard: 0.0      # 0% (hard uses rule 1 or 2 or skip)
          medium: 0.5    # 50% chance when rule 1/2 don't execute
          easy: 0.4      # 40% chance when rule 1/2/3 don't execute
      
      # Rule 5 (Medium/Easy): Random swap: our card <-> other player's card
      - name: "swap_random_two_players"
        priority: 5
        description: "Random swap of 2 cards (excluding collection) from any 2 other players"
        condition:
          type: "and"
          conditions:
            # Check if there are at least 2 other players
            - field: "all_players"
              operator: "not_empty"
            # Check if acting player has cards in hand (excluding collection)
            - field: "acting_player.hand"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "random_two_players"
        # Probability-based execution (easy/medium do random swap instead of skip)
        execution_probability:
          expert: 0.0    # 0% chance (expert uses rule 1 or 2)
          hard: 0.0      # 0% chance (hard uses rule 1 or 2 or skip)
          medium: 0.4    # 40% chance when rule 1/2/3 don't execute
          easy: 0.6      # 60% chance when rule 1/2/3/4 don't execute
      
      # Rule 6: Skip swap (fallback)
      - name: "skip_jack_swap"
        priority: 6
        description: "Skip using Jack swap"
        condition:
          type: "always"
        action:
          type: "skip_special_play"
        # Only skip when rules 1â€“5 don't execute
        execution_probability:
          expert: 0.0    # 0% chance (expert uses rule 1, 2 or 3)
          hard: 0.0      # 0% chance (hard uses rule 1, 2 or 3 or skip)
          medium: 0.0    # 0% chance (medium uses rule 2, 3, 4 or 5 if rule 1 doesn't execute)
          easy: 0.0      # 0% chance (easy uses rule 2, 3, 4 or 5 if rule 1 doesn't execute)
      
  queen_peek:
    # Decision logic for Queen peek
    optimal_peek_probability:
      easy: 0.6      # 60% chance to peek optimally
      medium: 0.8    # 80% chance to peek optimally
      hard: 0.95     # 95% chance to peek optimally
      expert: 1.0    # 100% chance to peek optimally (always optimal)
    
    # NEW: YAML-driven strategy rules (ordered from expert down to easy)
    strategy_rules:
      # Rule 1 (Expert/Hard): Peek at own cards that are not yet in known cards (excluding collection cards)
      - name: "peek_own_unknown_cards"
        priority: 1
        description: "Peek at own cards that are not yet in known cards (excluding collection cards)"
        condition:
          type: "and"
          conditions:
            # Check if acting player has cards in hand
            - field: "acting_player.hand"
              operator: "not_empty"
            # Check if acting player has known cards (to compare against)
            - field: "acting_player.known_cards"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "own_unknown_cards"
        # Probability-based execution (expert/hard use this rule)
        execution_probability:
          expert: 1.0    # 100% chance to execute if condition met
          hard: 0.95     # 95% chance to execute if condition met
          medium: 0.7    # 70% chance to execute if condition met
          easy: 0.5      # 50% chance to execute if condition met
      
      # Rule 2 (Medium/Easy): Random peek at any player's card (excluding their collection cards)
      - name: "peek_random_other_player"
        priority: 2
        description: "Random peek at any player's card (excluding their collection cards)"
        condition:
          type: "and"
          conditions:
            # Check if there are other players
            - field: "all_players"
              operator: "not_empty"
        action:
          type: "use_special_play"
          select_targets: true
          target_strategy: "random_other_player"
        execution_probability:
          expert: 1.0    # 100% chance to execute if condition met
          hard: 0.95     # 95% chance to execute if condition met
          medium: 0.7    # 70% chance to execute if condition met
          easy: 0.5      # 50% chance to execute if condition met
      
      # Rule 3: Skip peek (fallback)
      - name: "skip_queen_peek"
        priority: 3
        description: "Skip using Queen peek"
        condition:
          type: "always"
        action:
          type: "skip_special_play"

  collect_from_discard:
    # Decision logic for collecting from discard pile
    optimal_collect_probability:
      easy: 0.6      # 60% chance to collect optimally
      medium: 0.8    # 80% chance to collect optimally
      hard: 0.95     # 95% chance to collect optimally
      expert: 1.0    # 100% chance to collect optimally (always optimal)
    
    # YAML-driven strategy rules (ordered from expert down to easy)
    strategy_rules:
      # Rule 1 (Expert/Hard): Collect if player has 3 collection cards already and this is the only remaining card with same rank
      - name: "collect_if_completes_set"
        priority: 1
        description: "Collect if player has 3 collection cards and this is the only remaining card with same rank"
        condition:
          type: "and"
          conditions:
            # Check if acting player has 3 collection cards
            - field: "acting_player.collection_cards"
              operator: "length_equals"
              value: 3
            # Check if discard pile top card exists
            - field: "discard_pile.top_card"
              operator: "exists"
        action:
          type: "collect_from_discard"
        execution_probability:
          expert: 1.0    # 100% chance to execute if condition met
          hard: 0.95     # 95% chance to execute if condition met
          medium: 0.7    # 70% chance to execute if condition met
          easy: 0.5      # 50% chance to execute if condition met
      
      # Rule 2 (Medium/Easy): Collect if same rank as collection rank
      - name: "collect_if_same_rank"
        priority: 2
        description: "Collect if discard pile top card has same rank as collection rank"
        condition:
          type: "and"
          conditions:
            # Check if discard pile top card exists
            - field: "discard_pile.top_card"
              operator: "exists"
        action:
          type: "collect_from_discard"
        execution_probability:
          expert: 0.0    # 0% chance (expert uses rule 1)
          hard: 0.05     # 5% chance (hard prefers rule 1)
          medium: 0.3    # 30% chance (medium uses this as fallback)
          easy: 0.5      # 50% chance (easy uses this more often)
      
      # Rule 3: Skip collection (fallback)
      - name: "skip_collect"
        priority: 3
        description: "Skip collecting from discard pile"
        condition:
          type: "always"
        action:
          type: "skip_collect"

# Computer player statistics (for validation)
computer_stats:
  total_difficulties: 4
  supported_events: 5
  config_version: "1.0"
  
  difficulty_distribution:
    easy: 25
    medium: 50
    hard: 20
    expert: 5
